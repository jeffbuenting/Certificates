# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the action will run. 
on:
  # Triggers the workflow on push or pull request events but only for the master branch
  push:
    branches: [ jeffbuenting-patch-1 ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  pester-test:
    name: Pester test
    runs-on: windows-latest
    steps:
    - name: Check out repository code
      uses: actions/checkout@v2
    - name: Perform a Pester test from the Tests.ps1 file
      shell: pwsh
      run: 
        $Module = Get-Module ($env:GITHUB_REPOSITORY -split '/')[1];
        $Module | FL *
        
        #$ModuleName = $ModulePath | Split-Path -Leaf
        #$Module = Get-module -Name $ModuleName -Verbose
        
        #Get-ChildItem "$($Module.ModuleBase)\tests" -Filter '*.Tests.ps1' -File -verbose | where { $_.Name.ToLower() -ne ("$ModuleName.Tests.ps1").ToLower() }
        #$TestResult = Invoke-Pester -Path ".\Tests" -OutputFormat NUnitXml -OutputFile TestsResults.xml -PassThru
        #if ($TestResult.FailedCount -gt 0) { throw "$($Test.FailedCount) tests failed."}
